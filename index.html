<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Travel Here ‚Äî Formulaire</title>
  <meta name="description" content="Travel Here : Top 3 (pack vol + h√¥tel + activit√©) en affichage premium." />

  <style>
    :root{
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.74);
      --muted2: rgba(255,255,255,.58);
      --stroke: rgba(255,255,255,.20);
      --accent: #60A5FA;
      --accent2:#34D399;
      --shadow: 0 22px 64px rgba(0,0,0,.45);
      --r: 18px;
      --r2: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background:#050711;
      overflow-x:hidden;
    }

    /* Background slideshow */
    .bg{ position:fixed; inset:0; z-index:-3; background:#050711; }
    .bg .slide{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform: scale(1.06);
      animation: slideShow 30s infinite;
      filter: saturate(1.12) contrast(1.06);
    }
    .bg .slide:nth-child(1){ background-image:url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=2200&q=80"); animation-delay:0s; }
    .bg .slide:nth-child(2){ background-image:url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=2200&q=80"); animation-delay:6s; }
    .bg .slide:nth-child(3){ background-image:url("https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&w=2200&q=80"); animation-delay:12s; }
    .bg .slide:nth-child(4){ background-image:url("https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=2200&q=80"); animation-delay:18s; }
    .bg .slide:nth-child(5){ background-image:url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=2200&q=80"); animation-delay:24s; }
    @keyframes slideShow{
      0%{opacity:0}
      10%{opacity:1}
      25%{opacity:1}
      35%{opacity:0}
      100%{opacity:0}
    }

    .overlay{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 30%, rgba(52,211,153,.16), transparent 60%),
        linear-gradient(180deg, rgba(3,7,18,.52), rgba(3,7,18,.40));
    }

    .noise{
      pointer-events:none;
      position:fixed; inset:0; z-index:-1;
      opacity:.08;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      animation: noiseShift 10s linear infinite;
    }
    @keyframes noiseShift{
      0%{transform:translate3d(0,0,0)}
      100%{transform:translate3d(-80px,60px,0)}
    }

    /* Layout */
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }
    .shell{ width: min(980px, 100%); display:grid; grid-template-columns: 1fr; }
    .panel{
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.10));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .right{ padding: 14px 12px; }

    /* Header */
    .brandRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight: 1000; letter-spacing:-.8px; font-size: 18px;
    }
    .logoDot{
      width:10px; height:10px; border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 7px rgba(96,165,250,.12);
      display:inline-block;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(96,165,250,.16);
      border: 1px solid rgba(96,165,250,.26);
      color: rgba(255,255,255,.92);
      font-size: 13px; letter-spacing:.2px;
      user-select:none; white-space:nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(52,211,153,.18);
      animation: pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:scale(1); opacity:1}
      50%{transform:scale(1.25); opacity:.72}
    }

    .topLine{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .topLine h2{ margin:0; font-size: 16px; letter-spacing:-.2px; }
    .hint{ margin-top:2px; color: var(--muted2); font-size: 12.5px; }

    /* Progress */
    .progressWrap{
      margin: 10px 0 10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
    }
    .progressTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      color: rgba(255,255,255,.76); font-size: 12px;
    }
    .bar{
      height: 8px; border-radius: 999px;
      background: rgba(255,255,255,.12);
      margin-top: 8px; overflow:hidden;
    }
    .bar > div{
      height:100%; width:33%;
      border-radius:999px;
      background: linear-gradient(135deg, rgba(96,165,250,1), rgba(52,211,153,.95));
      transition: width .25s ease;
    }

    /* Form */
    form{ display:grid; gap: 12px; margin-top: 10px; }
    .grid2{ display:grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 680px){ .grid2{grid-template-columns:1fr;} }
    label{
      display:block; font-size: 12.5px;
      color: rgba(255,255,255,.82);
      margin-bottom: 6px;
    }
    .field{position:relative;}
    input, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      outline:none;
      transition: border-color .18s ease, background .18s ease, box-shadow .18s ease, transform .18s ease;
      backdrop-filter: blur(10px);
      font-size: 16px; /* anti-zoom iPhone */
    }
    textarea{min-height: 110px; resize: vertical}
    input::placeholder, textarea::placeholder{color: rgba(255,255,255,.52)}
    input:focus, textarea:focus{
      border-color: rgba(96,165,250,.55);
      box-shadow: 0 0 0 4px rgba(96,165,250,.18);
      background: rgba(0,0,0,.22);
      transform: translateY(-1px);
    }

    .dateInput{ padding-right: 46px; cursor:pointer; }
    .calIcon{
      position:absolute; right: 10px; top: 34px;
      width: 22px; height: 22px; opacity:.92;
      cursor:pointer; pointer-events:auto;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.25));
    }

    /* Pills */
    .pillGroup{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 8px; }
    .pill{
      cursor:pointer; user-select:none;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.90);
      font-size: 13px;
      font-weight: 900;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      white-space:nowrap;
    }
    .pill:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .pill[data-on="1"]{ background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.34); }
    .sr{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;}

    /* Chips */
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;}
    .chip{
      cursor:pointer; user-select:none;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.90);
      font-size: 12.5px;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      white-space:nowrap;
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .chip[data-on="1"]{ background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.32); }

    /* Notes counter */
    .counterRow{
      display:flex; justify-content:space-between; gap:10px;
      margin-top:6px; color: rgba(255,255,255,.62);
      font-size: 12px;
    }

    /* Autocomplete dropdown */
    .suggest{
      position:absolute;
      top: calc(100% + 8px);
      left:0; right:0;
      background: rgba(10,12,20,.90);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: 0 18px 44px rgba(0,0,0,.45);
      display:none;
      z-index: 50;
      backdrop-filter: blur(12px);
      max-height: 320px;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
    }
    .suggest button{
      width:100%;
      text-align:left;
      border:0;
      background: transparent;
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      cursor:pointer;
      font-size: 14px;
      transition: background .14s ease;
    }
    .suggest button:hover{ background: rgba(96,165,250,.14); }

    /* Buttons */
    .btn{
      border:0; width:100%;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 1000; letter-spacing:.2px;
      color:white;
      background: linear-gradient(135deg, rgba(96,165,250,1), rgba(52,211,153,.95));
      box-shadow: 0 14px 38px rgba(0,0,0,.26);
      cursor:pointer;
      transition: transform .16s ease, filter .16s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(.98)}
    .btn:disabled{ opacity:.65; cursor:not-allowed; transform:none; }
    .secondaryBtn{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:white;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
      width:100%;
    }

    /* Desktop date picker */
    .dpBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px 12px;
      z-index: 120;
    }
    .dp{
      width: min(360px, 100%);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.10));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .dpHeader{
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.14);
    }
    .dpHeader b{ font-size: 14px; letter-spacing:-.2px; }
    .dpNav{ display:flex; gap: 8px; }
    .dpBtn{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      width: 34px; height:34px;
      border-radius: 12px;
      cursor:pointer;
    }
    .dpGrid{ padding: 10px 12px 14px; }
    .dpWeek{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
      text-align:center;
    }
    .dpDays{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .day{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.92);
      border-radius: 12px;
      height: 40px;
      cursor:pointer;
      font-weight: 900;
      font-size: 13px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .day:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(96,165,250,.14); }
    .day.isToday{ border-color: rgba(52,211,153,.32); background: rgba(52,211,153,.10); }
    .day.isSelected{ border-color: rgba(96,165,250,.45); background: rgba(96,165,250,.22); }

    /* RESULTS (super mis en avant) */
    .resultHero{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(900px 380px at 10% 0%, rgba(96,165,250,.34), transparent 55%),
        radial-gradient(900px 380px at 90% 0%, rgba(52,211,153,.26), transparent 55%),
        rgba(255,255,255,.08);
      box-shadow: 0 28px 90px rgba(0,0,0,.55);
      overflow:hidden;
      transform: translateY(10px) scale(.985);
      opacity: 0;
      transition: transform .45s ease, opacity .45s ease;
    }
    .resultHero.on{
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    .resultHeroHead{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .resultHeroHead h3{
      margin:0;
      font-size: 15px;
      letter-spacing:-.2px;
    }
    .resultHeroHead .sub{
      margin: 4px 0 0;
      color: rgba(255,255,255,.72);
      font-size: 12.5px;
      line-height: 1.3;
    }
    .pillMini{
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }

    .rankGrid{ padding: 12px; display:grid; gap: 10px; }
    .rankCard{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.16);
      overflow:hidden;
      animation: popIn .35s ease both;
    }
    .rankCard:nth-child(2){ animation-delay: .06s; }
    .rankCard:nth-child(3){ animation-delay: .12s; }
    @keyframes popIn{
      from{ transform: translateY(8px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }

    .rankTop{
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
    }
    .rankTop b{
      display:flex; align-items:center; gap:10px;
      font-size: 13.5px;
      letter-spacing:-.2px;
    }
    .rankBadge{
      width: 26px; height:26px;
      border-radius: 10px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(96,165,250,.30), rgba(52,211,153,.22));
      border: 1px solid rgba(255,255,255,.18);
      font-weight: 1000;
    }
    .rankMeta{ display:flex; gap: 8px; flex-wrap:wrap; justify-content:flex-end; }
    .metaTag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(96,165,250,.14);
      border: 1px solid rgba(96,165,250,.22);
      color: rgba(255,255,255,.84);
      white-space:nowrap;
    }

    .rankBody{ padding: 10px 12px 12px; display:grid; gap: 8px; }
    .triple{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 10px;
    }
    .tripleHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .tripleHead .t{
      font-weight: 1000;
      font-size: 12.5px;
      letter-spacing:-.2px;
      display:flex; align-items:center; gap:8px;
    }
    .price{
      font-weight: 1000;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(52,211,153,.14);
      border: 1px solid rgba(52,211,153,.22);
      color: rgba(255,255,255,.90);
      white-space:nowrap;
    }
    .line{ font-size: 12.5px; color: rgba(255,255,255,.80); line-height: 1.35; }
    .mini{ margin-top: 2px; font-size: 12px; color: rgba(255,255,255,.62); line-height: 1.35; }

    .loadingBlock{ padding: 14px; display:grid; gap: 10px; }
    .loadingLine{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      position:relative;
    }
    .loadingLine::after{
      content:"";
      position:absolute; inset:0;
      transform: translateX(-60%);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      animation: shimmer 1.2s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{ transform: translateX(-60%); }
      100%{ transform: translateX(60%); }
    }

    .errorBox{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(251,113,133,.10);
    }
  </style>
</head>

<body>
  <div class="bg">
    <div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div>
  </div>
  <div class="overlay"></div>
  <div class="noise"></div>

  <div class="wrap">
    <div class="shell">
      <aside class="panel right">
        <div class="brandRow">
          <div class="brand"><span class="logoDot"></span><span>Travel Here</span></div>
          <div class="badge"><span class="dot"></span><span>Premium</span></div>
        </div>

        <div class="topLine">
          <div>
            <h2>Formulaire</h2>
            <div class="hint">3 √©tapes ‚Ä¢ le r√©sultat s‚Äôaffiche ici √† la fin</div>
          </div>
          <div class="badge" style="background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18);">
            <span style="opacity:.92">~ 45s</span>
          </div>
        </div>

        <div class="progressWrap">
          <div class="progressTop">
            <span id="stepLabel">√âtape 1/3</span>
            <span id="stepHint">Voyage</span>
          </div>
          <div class="bar"><div id="progressBar"></div></div>
        </div>

        <form id="tripForm" novalidate>
          <!-- STEP 1 -->
          <div class="step" data-step="1">
            <div class="grid2">
              <div class="field">
                <label for="origin">Ville de d√©part</label>
                <input id="origin" name="origin" placeholder="Tape une ville..." autocomplete="off" />
                <div class="suggest" id="originSuggest"></div>
              </div>

              <div class="field">
                <label for="destination">Destination</label>
                <input id="destination" name="destination" placeholder="Tape une ville..." autocomplete="off" required />
                <div class="suggest" id="destSuggest"></div>
              </div>
            </div>

            <div class="grid2">
              <div class="field">
                <label for="checkInDate">Date d‚Äôarriv√©e</label>
                <input id="checkInDate" name="checkInDate" class="dateInput" placeholder="Choisir une date" autocomplete="off" required />
                <svg class="calIcon" id="calIconIn" viewBox="0 0 24 24" fill="none" role="button" aria-label="Ouvrir calendrier arriv√©e">
                  <path d="M7 2v3M17 2v3M3.5 9h17" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M6 6h12a2.5 2.5 0 0 1 2.5 2.5V19A2.5 2.5 0 0 1 18 21.5H6A2.5 2.5 0 0 1 3.5 19V8.5A2.5 2.5 0 0 1 6 6Z" stroke="white" stroke-opacity=".9" stroke-width="1.6"/>
                </svg>
              </div>

              <div class="field">
                <label for="checkOutDate">Date de d√©part</label>
                <input id="checkOutDate" name="checkOutDate" class="dateInput" placeholder="Choisir une date" autocomplete="off" required />
                <svg class="calIcon" id="calIconOut" viewBox="0 0 24 24" fill="none" role="button" aria-label="Ouvrir calendrier d√©part">
                  <path d="M7 2v3M17 2v3M3.5 9h17" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M6 6h12a2.5 2.5 0 0 1 2.5 2.5V19A2.5 2.5 0 0 1 18 21.5H6A2.5 2.5 0 0 1 3.5 19V8.5A2.5 2.5 0 0 1 6 6Z" stroke="white" stroke-opacity=".9" stroke-width="1.6"/>
                </svg>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="step" data-step="2" style="display:none">
            <div class="grid2">
              <div class="field">
                <label for="adults">Adultes</label>
                <input id="adults" name="adults" type="number" min="1" max="9" value="2" />
              </div>
              <div class="field">
                <label for="children">Enfants</label>
                <input id="children" name="children" type="number" min="0" max="9" value="0" />
              </div>
            </div>

            <div class="grid2">
              <div class="field">
                <label for="roomQuantity">Chambres</label>
                <input id="roomQuantity" name="roomQuantity" type="number" min="1" max="9" value="1" />
              </div>
              <div class="field">
                <label for="budget">Budget total (optionnel)</label>
                <input id="budget" name="budget" type="number" min="0" step="50" placeholder="Ex : 1200" />
              </div>
            </div>

            <div class="field">
              <label>Style</label>
              <div class="pillGroup" id="stylePills">
                <span class="pill" data-value="balanced" data-on="1">√âquilibr√©</span>
                <span class="pill" data-value="budget">Petit budget</span>
                <span class="pill" data-value="comfort">Confort</span>
                <span class="pill" data-value="luxury">Luxe</span>
              </div>
              <input class="sr" id="style" name="style" value="balanced" />
            </div>

            <div class="field">
              <label>Centres d‚Äôint√©r√™t (optionnel)</label>
              <div class="chips" id="chips">
                <span class="chip" data-value="culture">Culture</span>
                <span class="chip" data-value="food">Food</span>
                <span class="chip" data-value="nature">Nature</span>
                <span class="chip" data-value="festivities">Festivit√©s</span>
                <span class="chip" data-value="romance">Romantique</span>
                <span class="chip" data-value="family">Famille</span>
                <span class="chip" data-value="adventure">Aventure</span>
                <span class="chip" data-value="beach">Plage</span>
                <span class="chip" data-value="shopping">Shopping</span>
                <span class="chip" data-value="relax">D√©tente</span>
              </div>
              <input class="sr" id="interests" name="interests" value="" />
            </div>
          </div>

          <!-- STEP 3 -->
          <div class="step" data-step="3" style="display:none">
            <!-- Notes (dispara√Æt quand les r√©sultats apparaissent) -->
            <div id="notesWrap">
              <div class="field">
                <label for="notes">Notes (optionnel)</label>
                <textarea id="notes" name="notes" maxlength="250" placeholder="Ex : h√¥tel proche centre, d√©part le matin, pas trop de marche‚Ä¶"></textarea>
                <div class="counterRow">
                  <span>Max 250 caract√®res</span>
                  <span id="notesCount">0/250</span>
                </div>
              </div>
            </div>

            <!-- Results (seul visible apr√®s g√©n√©ration) -->
            <div class="resultHero" id="resultHero" style="display:none;">
              <div class="resultHeroHead">
                <div>
                  <h3>Ton Top 3 personnalis√©</h3>
                  <div class="sub" id="resultSub">‚Äî</div>
                </div>
                <div class="pillMini">√âtape 3/3</div>
              </div>

              <div id="loadingBlock" class="loadingBlock" style="display:none;">
                <div class="loadingLine"></div>
                <div class="loadingLine" style="width:78%"></div>
                <div class="loadingLine" style="width:62%"></div>
                <div class="loadingLine" style="width:70%"></div>
              </div>

              <div class="rankGrid" id="rankGrid"></div>
            </div>
          </div>

          <div style="display:flex;gap:10px;">
            <button type="button" class="secondaryBtn" id="backBtn" style="flex:1;display:none;">Retour</button>
            <button type="button" class="btn" id="nextBtn" style="flex:2;">Continuer</button>
          </div>
        </form>
      </aside>
    </div>
  </div>

  <!-- Desktop date picker -->
  <div class="dpBackdrop" id="dpBackdrop">
    <div class="dp" role="dialog" aria-modal="true" aria-label="Choisir une date">
      <div class="dpHeader">
        <b id="dpTitle">Mois</b>
        <div class="dpNav">
          <button class="dpBtn" id="dpPrev" type="button">‚Äπ</button>
          <button class="dpBtn" id="dpNext" type="button">‚Ä∫</button>
        </div>
      </div>
      <div class="dpGrid">
        <div class="dpWeek">
          <div>L</div><div>M</div><div>M</div><div>J</div><div>V</div><div>S</div><div>D</div>
        </div>
        <div class="dpDays" id="dpDays"></div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const WEBHOOK_URL = "https://fullplata.app.n8n.cloud/webhook-test/voyage-ia";
    // IMPORTANT: webhook-test = marche quand ton workflow n8n est en mode test (Execute). Pour public -> webhook (prod).

    // ===========================
    // Fast autocomplete (priorit√© + cache + debounce + abort)
    // ===========================
    const POPULAR_CITIES = [
      { label: "Paris ‚Äî France", value: "Paris" },
      { label: "Lyon ‚Äî France", value: "Lyon" },
      { label: "Marseille ‚Äî France", value: "Marseille" },
      { label: "Nice ‚Äî France", value: "Nice" },
      { label: "Toulouse ‚Äî France", value: "Toulouse" },
      { label: "Bordeaux ‚Äî France", value: "Bordeaux" },
      { label: "Nantes ‚Äî France", value: "Nantes" },
      { label: "Lille ‚Äî France", value: "Lille" },
      { label: "Bruxelles ‚Äî Belgique", value: "Bruxelles" },
      { label: "Gen√®ve ‚Äî Suisse", value: "Gen√®ve" },
      { label: "Londres ‚Äî Royaume-Uni", value: "Londres" },
      { label: "Barcelone ‚Äî Espagne", value: "Barcelone" },
      { label: "Madrid ‚Äî Espagne", value: "Madrid" },
      { label: "Lisbonne ‚Äî Portugal", value: "Lisbonne" },
      { label: "Rome ‚Äî Italie", value: "Rome" },
      { label: "Milan ‚Äî Italie", value: "Milan" },
      { label: "Berlin ‚Äî Allemagne", value: "Berlin" },
      { label: "Amsterdam ‚Äî Pays-Bas", value: "Amsterdam" },
      { label: "Prague ‚Äî R√©publique tch√®que", value: "Prague" },
      { label: "Ath√®nes ‚Äî Gr√®ce", value: "Ath√®nes" },
      { label: "Istanbul ‚Äî Turquie", value: "Istanbul" },
      { label: "New York ‚Äî USA", value: "New York" },
      { label: "Montr√©al ‚Äî Canada", value: "Montr√©al" },
      { label: "Dubai ‚Äî √âmirats arabes unis", value: "Dubai" },
      { label: "Bangkok ‚Äî Tha√Ølande", value: "Bangkok" },
      { label: "Tokyo ‚Äî Japon", value: "Tokyo" }
    ];

    const cityCache = new Map();
    function normQ(q){ return (q||"").trim().toLowerCase(); }

    function fastLocalSuggest(q){
      const n = normQ(q);
      if(n.length < 1) return [];
      const prefix = POPULAR_CITIES.filter(c => c.value.toLowerCase().startsWith(n));
      const contains = POPULAR_CITIES.filter(c => !c.value.toLowerCase().startsWith(n) && c.value.toLowerCase().includes(n));
      return [...prefix, ...contains].slice(0, 6);
    }

    async function fetchCitySuggestions(query, signal){
      const q = query.trim();
      if(q.length < 2) return [];
      const key = normQ(q);
      if(cityCache.has(key)) return cityCache.get(key);

      const url = "https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=8&accept-language=fr&q=" + encodeURIComponent(q);
      const res = await fetch(url, { headers: { "Accept": "application/json" }, signal });
      if(!res.ok) throw new Error("nominatim");
      const data = await res.json();

      const items = data.map(item => {
        const city = item.address?.city || item.address?.town || item.address?.village || item.address?.municipality || item.display_name?.split(",")[0] || "";
        const country = item.address?.country || "";
        return { label: city ? `${city} ‚Äî ${country}` : item.display_name, value: city ? `${city}` : item.display_name };
      }).filter(x => x.value);

      cityCache.set(key, items);
      if(cityCache.size > 80){
        const firstKey = cityCache.keys().next().value;
        cityCache.delete(firstKey);
      }
      return items;
    }

    function esc(str){
      return String(str)
        .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    function attachSuggest(inputId, suggestId){
      const input = document.getElementById(inputId);
      const box = document.getElementById(suggestId);

      let t = null;
      let controller = null;

      function hide(){ box.style.display = "none"; box.innerHTML = ""; }
      function render(items){
        if(!items || items.length === 0){ hide(); return; }
        box.innerHTML = items.map(it => `
          <button type="button" data-value="${esc(it.value)}"><div>${esc(it.label)}</div></button>
        `).join("");
        box.style.display = "block";
      }

      function handleInput(){
        const q = input.value || "";

        const local = fastLocalSuggest(q);
        render(local);

        if(t) clearTimeout(t);
        t = setTimeout(async () => {
          const qq = input.value || "";
          if(qq.trim().length < 2) return;

          if(controller) controller.abort();
          controller = new AbortController();

          try{
            const remote = await fetchCitySuggestions(qq, controller.signal);
            const merged = [];
            const seen = new Set();

            for(const it of fastLocalSuggest(qq)){
              const k = it.value.toLowerCase();
              if(!seen.has(k)){ seen.add(k); merged.push(it); }
            }
            for(const it of remote){
              const k = it.value.toLowerCase();
              if(!seen.has(k)){ seen.add(k); merged.push(it); }
            }
            render(merged.slice(0, 8));
          }catch(e){ /* ignore */ }
        }, 120);
      }

      input.addEventListener("input", handleInput);
      input.addEventListener("focus", () => {
        if((input.value || "").trim().length === 0) render(POPULAR_CITIES.slice(0, 8));
        else handleInput();
      });

      box.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if(!btn) return;
        input.value = btn.dataset.value;
        hide();
        input.dispatchEvent(new Event("change"));
      });

      document.addEventListener("click", (e) => {
        if(e.target === input || box.contains(e.target)) return;
        hide();
      });

      input.addEventListener("keydown", (e) => { if(e.key === "Escape") hide(); });
    }

    attachSuggest("origin", "originSuggest");
    attachSuggest("destination", "destSuggest");

    // ===========================
    // Style / interests
    // ===========================
    const stylePills = document.getElementById('stylePills');
    const styleInput = document.getElementById('style');
    stylePills.addEventListener('click', (e) => {
      const pill = e.target.closest('.pill');
      if(!pill) return;
      [...stylePills.querySelectorAll('.pill')].forEach(p => p.dataset.on = "0");
      pill.dataset.on = "1";
      styleInput.value = pill.dataset.value;
    });

    const chips = document.getElementById('chips');
    const interestsInput = document.getElementById('interests');
    chips.addEventListener('click', (e) => {
      const chip = e.target.closest('.chip');
      if(!chip) return;
      chip.dataset.on = chip.dataset.on === "1" ? "0" : "1";
      interestsInput.value = [...chips.querySelectorAll('.chip[data-on="1"]')].map(el => el.dataset.value).join(',');
    });

    // Notes counter
    const notesEl = document.getElementById('notes');
    const notesCount = document.getElementById('notesCount');
    function updateNotesCount(){ notesCount.textContent = `${(notesEl.value||"").length}/250`; }
    notesEl.addEventListener('input', updateNotesCount);
    updateNotesCount();

    // ===========================
    // Date UX (icon opens)
    // ===========================
    const dpBackdrop = document.getElementById("dpBackdrop");
    const dpTitle = document.getElementById("dpTitle");
    const dpDays = document.getElementById("dpDays");
    const dpPrev = document.getElementById("dpPrev");
    const dpNext = document.getElementById("dpNext");

    let activeDateInput = null;
    let viewDate = new Date();
    let selectedDateISO = null;

    const MONTHS_FR = ["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];
    function pad(n){ return String(n).padStart(2,"0"); }
    function toISO(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
    function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
    function daysInMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0).getDate(); }

    function openDatePicker(inputEl){
      activeDateInput = inputEl;

      if(inputEl.value && /^\d{4}-\d{2}-\d{2}$/.test(inputEl.value)){
        const [y,m,da] = inputEl.value.split("-").map(Number);
        viewDate = new Date(y, m-1, 1);
        selectedDateISO = inputEl.value;
      } else {
        viewDate = new Date();
        selectedDateISO = null;
      }

      renderCalendar();
      dpBackdrop.style.display = "flex";
      document.body.style.overflow = "hidden";
    }
    function closeDatePicker(){
      dpBackdrop.style.display = "none";
      document.body.style.overflow = "";
      activeDateInput = null;
    }
    function renderCalendar(){
      const m = viewDate.getMonth();
      const y = viewDate.getFullYear();
      dpTitle.textContent = `${MONTHS_FR[m]} ${y}`;
      dpDays.innerHTML = "";

      const first = startOfMonth(viewDate);
      const firstDow = (first.getDay() + 6) % 7; // Monday=0
      const total = daysInMonth(viewDate);
      for(let i=0;i<firstDow;i++){
        const blank = document.createElement("div");
        blank.style.height = "40px";
        dpDays.appendChild(blank);
      }

      const todayISO = toISO(new Date());
      for(let day=1; day<=total; day++){
        const d = new Date(y, m, day);
        const iso = toISO(d);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "day";
        btn.textContent = String(day);

        if(iso === todayISO) btn.classList.add("isToday");
        if(selectedDateISO && iso === selectedDateISO) btn.classList.add("isSelected");

        btn.addEventListener("click", () => {
          selectedDateISO = iso;
          if(activeDateInput){
            activeDateInput.value = iso;
            activeDateInput.dispatchEvent(new Event("change"));
          }
          closeDatePicker();
        });
        dpDays.appendChild(btn);
      }
    }
    dpPrev.addEventListener("click", () => { viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1); renderCalendar(); });
    dpNext.addEventListener("click", () => { viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1); renderCalendar(); });
    dpBackdrop.addEventListener("click", (e) => { if(e.target === dpBackdrop) closeDatePicker(); });

    function isMobile(){
      return window.matchMedia("(max-width: 900px)").matches || /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    const checkIn = document.getElementById("checkInDate");
    const checkOut = document.getElementById("checkOutDate");
    const calIconIn = document.getElementById("calIconIn");
    const calIconOut = document.getElementById("calIconOut");

    function enableDateUX(){
      if(isMobile()){
        checkIn.type = "date";
        checkOut.type = "date";
        checkIn.placeholder = "";
        checkOut.placeholder = "";
        calIconIn.onclick = () => { checkIn.showPicker?.(); checkIn.focus(); checkIn.click(); };
        calIconOut.onclick = () => { checkOut.showPicker?.(); checkOut.focus(); checkOut.click(); };
        return;
      }
      checkIn.type = "text";
      checkOut.type = "text";
      checkIn.addEventListener("click", () => openDatePicker(checkIn));
      checkOut.addEventListener("click", () => openDatePicker(checkOut));
      checkIn.addEventListener("keydown", (e) => e.preventDefault());
      checkOut.addEventListener("keydown", (e) => e.preventDefault());
      calIconIn.onclick = () => openDatePicker(checkIn);
      calIconOut.onclick = () => openDatePicker(checkOut);
    }
    enableDateUX();

    // ===========================
    // Steps + Progress
    // ===========================
    let currentStep = 1;
    const steps = [...document.querySelectorAll('.step[data-step]')];
    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');
    const stepLabel = document.getElementById('stepLabel');
    const stepHint = document.getElementById('stepHint');
    const progressBar = document.getElementById('progressBar');
    const hints = { 1: "Voyage", 2: "Pr√©f√©rences", 3: "R√©sultat" };

    function showStep(n){
      currentStep = n;
      steps.forEach(s => s.style.display = (Number(s.dataset.step) === n) ? "block" : "none");
      backBtn.style.display = (n === 1) ? "none" : "inline-flex";
      nextBtn.textContent = (n === 3) ? "Voir mon Top 3" : "Continuer";
      stepLabel.textContent = `√âtape ${n}/3`;
      stepHint.textContent = hints[n] || "";
      progressBar.style.width = (n === 1 ? "33%" : n === 2 ? "66%" : "100%");
      window.scrollTo({top: 0, behavior: "smooth"});
    }

    function isValidDates(inDate, outDate){
      try{ return new Date(outDate) > new Date(inDate); }catch(e){ return false; }
    }
    function requiredOkForStep1(){
      const dest = document.getElementById('destination')?.value?.trim();
      const inD = document.getElementById('checkInDate')?.value?.trim();
      const outD = document.getElementById('checkOutDate')?.value?.trim();
      if(!dest || !inD || !outD) return false;
      if(!isValidDates(inD, outD)) return false;
      return true;
    }

    backBtn.addEventListener('click', () => { if(currentStep > 1) showStep(currentStep - 1); });
    nextBtn.addEventListener('click', async () => {
      if(currentStep === 1){
        if(!requiredOkForStep1()){ alert("Remplis destination + dates (d√©part apr√®s arriv√©e)."); return; }
        showStep(2); return;
      }
      if(currentStep === 2){ showStep(3); return; }
      if(currentStep === 3){ await showTop3TripletsFromN8N(); }
    });

    showStep(1);

    // ===========================
    // RESULTS: Top3 packs (vol + h√¥tel + activit√©) depuis n8n
    // Format attendu (id√©al):
    // { top3: [ { label, meta:[], flight:{title,line,price}, hotel:{title,line,price}, activity:{title,line,price} }, ... ] }
    // ===========================
    const notesWrap = document.getElementById("notesWrap");
    const resultHero = document.getElementById("resultHero");
    const resultSub = document.getElementById("resultSub");
    const loadingBlock = document.getElementById("loadingBlock");
    const rankGrid = document.getElementById("rankGrid");

    function getFormData(){
      return {
        origin: document.getElementById("origin")?.value?.trim() || "",
        destination: document.getElementById("destination")?.value?.trim() || "",
        checkInDate: document.getElementById("checkInDate")?.value?.trim() || "",
        checkOutDate: document.getElementById("checkOutDate")?.value?.trim() || "",
        adults: Number(document.getElementById("adults")?.value || 2),
        children: Number(document.getElementById("children")?.value || 0),
        roomQuantity: Number(document.getElementById("roomQuantity")?.value || 1),
        budget: document.getElementById("budget")?.value?.trim() || "",
        style: document.getElementById("style")?.value || "balanced",
        interests: document.getElementById("interests")?.value || "",
        notes: (document.getElementById("notes")?.value || "").trim()
      };
    }

    function renderTriplets(triplets, payload){
      const head = `${payload.destination || "‚Äî"} ‚Ä¢ ${payload.checkInDate || "‚Äî"} ‚Üí ${payload.checkOutDate || "‚Äî"} ‚Ä¢ ${payload.adults || 2} adulte(s)`;
      resultSub.textContent = head;

      const safeTriplets = triplets.slice(0,3);

      rankGrid.innerHTML = safeTriplets.map((t, idx) => `
        <div class="rankCard">
          <div class="rankTop">
            <b><span class="rankBadge">${idx+1}</span> ${esc(t.label || "Option")}</b>
            <div class="rankMeta">
              ${Array.isArray(t.meta) ? t.meta.slice(0,3).map(x => `<span class="metaTag">${esc(x)}</span>`).join("") : ""}
            </div>
          </div>
          <div class="rankBody">
            <div class="triple">
              <div class="tripleHead">
                <div class="t">‚úàÔ∏è Vol</div>
                <div class="price">${esc(t.flight?.price || "‚Äî")}</div>
              </div>
              <div class="line"><b>${esc(t.flight?.title || "‚Äî")}</b></div>
              <div class="mini">${esc(t.flight?.line || "‚Äî")}</div>
            </div>

            <div class="triple">
              <div class="tripleHead">
                <div class="t">üè® H√¥tel</div>
                <div class="price">${esc(t.hotel?.price || "‚Äî")}</div>
              </div>
              <div class="line"><b>${esc(t.hotel?.title || "‚Äî")}</b></div>
              <div class="mini">${esc(t.hotel?.line || "‚Äî")}</div>
            </div>

            <div class="triple">
              <div class="tripleHead">
                <div class="t">üéüÔ∏è Activit√©</div>
                <div class="price">${esc(t.activity?.price || "‚Äî")}</div>
              </div>
              <div class="line"><b>${esc(t.activity?.title || "‚Äî")}</b></div>
              <div class="mini">${esc(t.activity?.line || "‚Äî")}</div>
            </div>
          </div>
        </div>
      `).join("");
    }

    async function showTop3TripletsFromN8N(){
      const payload = getFormData();

      // UI: results only
      notesWrap.style.display = "none";
      resultHero.style.display = "block";
      requestAnimationFrame(() => resultHero.classList.add("on"));

      loadingBlock.style.display = "grid";
      rankGrid.innerHTML = "";

      nextBtn.disabled = true;
      nextBtn.textContent = "G√©n√©ration‚Ä¶";

      try{
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if(!res.ok) throw new Error("Webhook HTTP " + res.status);

        const data = await res.json();
        const triplets = Array.isArray(data.top3) ? data.top3 : [];

        loadingBlock.style.display = "none";

        if(triplets.length === 0){
          rankGrid.innerHTML = `
            <div class="errorBox">
              <div style="font-weight:1000;">Aucun Top 3 re√ßu</div>
              <div class="mini" style="margin-top:6px;">
                Ton webhook a r√©pondu, mais il n‚Äôa pas renvoy√© <b>top3</b>.
              </div>
            </div>
          `;
        } else {
          renderTriplets(triplets, payload);
          // auto scroll to results
          resultHero.scrollIntoView({ behavior: "smooth", block: "start" });
        }

      } catch (e){
        loadingBlock.style.display = "none";
        rankGrid.innerHTML = `
          <div class="errorBox">
            <div style="font-weight:1000;">Erreur d‚Äôappel n8n</div>
            <div class="mini" style="margin-top:6px;">
              Souvent c‚Äôest <b>CORS</b> ou le webhook-test inactif.
            </div>
            <div class="mini" style="opacity:.85;margin-top:6px;">${esc(e.message || String(e))}</div>
          </div>
        `;
      } finally {
        nextBtn.disabled = false;
        nextBtn.textContent = "R√©g√©n√©rer";
      }
    }
  </script>
</body>
</html>
