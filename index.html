<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Travel Here ‚Äî Formulaire</title>
  <meta name="description" content="Travel Here : formulaire premium pour g√©n√©rer une offre de voyage (vols, h√¥tels, activit√©s)." />

  <style>
    :root{
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.74);
      --muted2: rgba(255,255,255,.58);

      --card: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.20);

      --accent: #60A5FA;
      --accent2:#34D399;
      --danger:#FB7185;

      --shadow: 0 22px 64px rgba(0,0,0,.45);
      --r: 18px;
      --r2: 14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background:#050711;
      overflow-x:hidden;
    }

    /* ======= Background slideshow ======= */
    .bg{ position:fixed; inset:0; z-index:-3; background:#050711; }
    .bg .slide{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform: scale(1.06);
      animation: slideShow 30s infinite;
      filter: saturate(1.12) contrast(1.06);
    }
    .bg .slide:nth-child(1){ background-image:url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=2200&q=80"); animation-delay:0s; }
    .bg .slide:nth-child(2){ background-image:url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=2200&q=80"); animation-delay:6s; }
    .bg .slide:nth-child(3){ background-image:url("https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&w=2200&q=80"); animation-delay:12s; }
    .bg .slide:nth-child(4){ background-image:url("https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=2200&q=80"); animation-delay:18s; }
    .bg .slide:nth-child(5){ background-image:url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=2200&q=80"); animation-delay:24s; }
    @keyframes slideShow{
      0%{opacity:0}
      10%{opacity:1}
      25%{opacity:1}
      35%{opacity:0}
      100%{opacity:0}
    }

    .overlay{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 30%, rgba(52,211,153,.16), transparent 60%),
        linear-gradient(180deg, rgba(3,7,18,.52), rgba(3,7,18,.40));
    }

    .noise{
      pointer-events:none;
      position:fixed; inset:0; z-index:-1;
      opacity:.08;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      animation: noiseShift 10s linear infinite;
    }
    @keyframes noiseShift{
      0%{transform:translate3d(0,0,0)}
      100%{transform:translate3d(-80px,60px,0)}
    }

    /* ======= Layout ======= */
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 14px 12px;
    }

    .shell{
      width: min(1060px, 100%);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 14px;
      align-items: start;
    }

    @media (max-width: 900px){
      .shell{grid-template-columns: 1fr;}
    }

    .panel{
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.10));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
      transform: translateY(0);
      transition: transform .25s ease, border-color .25s ease;
      position:relative;
    }
    .panel:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.26); }

    .left{ padding: 20px 18px; }
    .right{ padding: 16px 14px; }

    /* ‚úÖ Mobile: on cache le panneau gauche pour que l‚Äôutilisateur commence direct le formulaire sans scroller */
    @media (max-width: 900px){
      .left{ display:none; }
      .wrap{ padding: 10px 10px; }
      .right{ padding: 14px 12px; }
    }

    /* Brand */
    .brandRowMini{
      display:none;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    @media (max-width: 900px){
      .brandRowMini{ display:flex; }
    }

    .brandMini{
      display:flex; align-items:center; gap:10px;
      font-weight: 1000;
      letter-spacing:-.8px;
      font-size: 18px;
    }

    .logoDot{
      width:10px; height:10px; border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 7px rgba(96,165,250,.12);
      display:inline-block;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(96,165,250,.16);
      border: 1px solid rgba(96,165,250,.26);
      color: rgba(255,255,255,.92);
      font-size: 13px;
      letter-spacing:.2px;
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(52,211,153,.18);
      animation: pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:scale(1); opacity:1}
      50%{transform:scale(1.25); opacity:.72}
    }

    h1{
      margin: 10px 0 8px;
      font-size: clamp(22px, 2.6vw, 34px);
      line-height: 1.08;
      letter-spacing:-.5px;
    }

    /* Form header */
    .topLine{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .topLine h2{ margin:0; font-size: 16px; letter-spacing:-.2px; }
    .hint{ margin-top:2px; color: var(--muted2); font-size: 12.5px; }

    form{ display:grid; gap: 12px; margin-top: 10px; }

    .grid2{ display:grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 680px){ .grid2{grid-template-columns:1fr;} }

    label{
      display:block;
      font-size: 12.5px;
      color: rgba(255,255,255,.82);
      margin-bottom: 6px;
    }
    .field{position:relative;}

    input, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      outline:none;
      transition: border-color .18s ease, background .18s ease, box-shadow .18s ease, transform .18s ease;
      backdrop-filter: blur(10px);
      font-size: 14px;
    }

    /* ‚úÖ Anti-zoom iPhone: 16px minimum sur mobile */
    @media (max-width: 900px){
      input, textarea{ font-size: 16px; }
    }

    textarea{min-height: 100px; resize: vertical}
    input::placeholder, textarea::placeholder{color: rgba(255,255,255,.52)}
    input:focus, textarea:focus{
      border-color: rgba(96,165,250,.55);
      box-shadow: 0 0 0 4px rgba(96,165,250,.18);
      background: rgba(0,0,0,.22);
      transform: translateY(-1px);
    }

    .dateInput{ padding-right: 46px; cursor:pointer; }
    .calIcon{
      position:absolute;
      right: 10px;
      top: 34px;
      width: 22px;
      height: 22px;
      opacity:.92;
      cursor:pointer;           /* ‚úÖ cliquable */
      pointer-events:auto;      /* ‚úÖ re√ßoit le clic */
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.25));
    }

    /* Pills */
    .pillGroup{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 8px; }
    .pill{
      cursor:pointer; user-select:none;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.90);
      font-size: 13px;
      font-weight: 900;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
    }
    .pill:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .pill[data-on="1"]{ background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.34); }
    .sr{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;}

    /* Chips */
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;}
    .chip{
      cursor:pointer; user-select:none;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.90);
      font-size: 12.5px;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      white-space:nowrap;
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .chip[data-on="1"]{ background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.32); }

    /* Autocomplete dropdown */
    .suggest{
      position:absolute;
      top: calc(100% + 8px);
      left:0; right:0;
      background: rgba(10,12,20,.86);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: 0 18px 44px rgba(0,0,0,.45);
      display:none;
      z-index: 50;
      backdrop-filter: blur(12px);
    }
    .suggest button{
      width:100%;
      text-align:left;
      border:0;
      background: transparent;
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      cursor:pointer;
      font-size: 13.5px;
      transition: background .14s ease;
    }
    .suggest button:hover{ background: rgba(96,165,250,.14); }
    .suggest .muted{ color: rgba(255,255,255,.60); font-size:12px; }

    /* CTA */
    .btn{
      border:0;
      width:100%;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 1000;
      letter-spacing:.2px;
      color:white;
      background: linear-gradient(135deg, rgba(96,165,250,1), rgba(52,211,153,.95));
      box-shadow: 0 14px 38px rgba(0,0,0,.26);
      cursor:pointer;
      transition: transform .16s ease, filter .16s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(.98)}

    .secondaryBtn{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:white;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .16s ease, filter .16s ease;
      width:100%;
    }
    .secondaryBtn:hover{ transform: translateY(-1px); filter: brightness(1.02); }

    .fine{ margin: 10px 0 0; color: rgba(255,255,255,.62); font-size: 12px; line-height:1.35; }

    /* Progress */
    .progressWrap{
      margin: 10px 0 10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
    }
    .progressTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: rgba(255,255,255,.76);
      font-size: 12px;
    }
    .bar{
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      margin-top: 8px;
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:33%;
      border-radius:999px;
      background: linear-gradient(135deg, rgba(96,165,250,1), rgba(52,211,153,.95));
      transition: width .25s ease;
    }

    /* Recap / results cards */
    .recap{
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      display:grid;
      gap: 6px;
      font-size: 13px;
      color: rgba(255,255,255,.86);
    }
    .recap .row{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      color: rgba(255,255,255,.86);
    }
    .recap .row span:last-child{
      font-weight:1000;
      color: rgba(255,255,255,.92);
      text-align:right;
    }

    .cards{
      display:grid;
      gap:10px;
    }
    .card{
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
    }
    .card h3{
      margin:0 0 6px;
      font-size: 13.5px;
      letter-spacing:-.2px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(96,165,250,.16);
      border: 1px solid rgba(96,165,250,.26);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }
    .muted{ color: rgba(255,255,255,.66); font-size: 12px; line-height:1.35; }
    .divider{ height:1px; background: rgba(255,255,255,.12); margin: 10px 0; }

    /* Notes counter */
    .counterRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top:6px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
    }

    /* ======= Custom Date Picker (desktop) ======= */
    .dpBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px 12px;
      z-index: 120;
    }
    .dp{
      width: min(360px, 100%);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.10));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .dpHeader{
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.14);
    }
    .dpHeader b{ font-size: 14px; letter-spacing:-.2px; }
    .dpNav{ display:flex; gap: 8px; }
    .dpBtn{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      width: 34px; height:34px;
      border-radius: 12px;
      cursor:pointer;
    }
    .dpGrid{ padding: 10px 12px 14px; }
    .dpWeek{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
      text-align:center;
    }
    .dpDays{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .day{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.92);
      border-radius: 12px;
      height: 40px;
      cursor:pointer;
      font-weight: 900;
      font-size: 13px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .day:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(96,165,250,.14); }
    .day.isToday{ border-color: rgba(52,211,153,.32); background: rgba(52,211,153,.10); }
    .day.isSelected{ border-color: rgba(96,165,250,.45); background: rgba(96,165,250,.22); }

    /* Small loading shimmer */
    .loadingLine{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      position:relative;
    }
    .loadingLine::after{
      content:"";
      position:absolute; inset:0;
      transform: translateX(-60%);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      animation: shimmer 1.2s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{ transform: translateX(-60%); }
      100%{ transform: translateX(60%); }
    }
  </style>
</head>

<body>
  <div class="bg">
    <div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div>
  </div>
  <div class="overlay"></div>
  <div class="noise"></div>

  <div class="wrap">
    <div class="shell">

      <!-- LEFT (masqu√© sur mobile) -->
      <section class="panel left">
        <div class="badge">
          <span class="dot"></span>
          <span>Service premium</span>
        </div>

        <h1 style="margin-top:10px;"><span class="logoDot"></span>Travel Here</h1>
        <p style="margin:0;color:var(--muted);line-height:1.55;">
          Remplis le formulaire, et re√ßois ton Top 3 (vols + h√¥tels + activit√©s) imm√©diatement apr√®s paiement.
        </p>

        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
          <span class="badge" style="background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.18);"><span style="opacity:.92;">‚ö° Imm√©diat</span></span>
          <span class="badge" style="background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.18);"><span style="opacity:.92;">üì± Mobile-first</span></span>
          <span class="badge" style="background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.18);"><span style="opacity:.92;">‚ú® Premium</span></span>
        </div>

        <p class="fine" style="margin-top:14px;">
          Travel Here ‚Äî exp√©rience pens√©e pour convertir depuis TikTok.
        </p>
      </section>

      <!-- RIGHT -->
      <aside class="panel right">
        <!-- Mini header sur mobile -->
        <div class="brandRowMini">
          <div class="brandMini"><span class="logoDot"></span><span>Travel Here</span></div>
          <div class="badge" style="background: rgba(96,165,250,.16); border-color: rgba(96,165,250,.26);">
            <span class="dot"></span><span>Premium</span>
          </div>
        </div>

        <div class="topLine">
          <div>
            <h2>Formulaire</h2>
            <div class="hint">3 √©tapes ‚Ä¢ r√©sultat affich√© √† la fin ‚úÖ</div>
          </div>
          <div class="badge" style="background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18);">
            <span style="opacity:.92">~ 45s</span>
          </div>
        </div>

        <!-- Progress -->
        <div class="progressWrap">
          <div class="progressTop">
            <span id="stepLabel">√âtape 1/3</span>
            <span id="stepHint">Voyage</span>
          </div>
          <div class="bar"><div id="progressBar"></div></div>
        </div>

        <form id="tripForm" novalidate>
          <!-- STEP 1 -->
          <div class="step" data-step="1">
            <div class="grid2">
              <div class="field">
                <label for="origin">Ville de d√©part</label>
                <input id="origin" name="origin" placeholder="Tape une ville..." autocomplete="off" />
                <div class="suggest" id="originSuggest"></div>
              </div>

              <div class="field">
                <label for="destination">Destination</label>
                <input id="destination" name="destination" placeholder="Tape une ville..." autocomplete="off" required />
                <div class="suggest" id="destSuggest"></div>
              </div>
            </div>

            <div class="grid2">
              <div class="field">
                <label for="checkInDate">Date d‚Äôarriv√©e</label>
                <input id="checkInDate" name="checkInDate" class="dateInput" placeholder="Choisir une date" autocomplete="off" required />
                <svg class="calIcon" id="calIconIn" viewBox="0 0 24 24" fill="none" aria-label="Ouvrir calendrier arriv√©e" role="button">
                  <path d="M7 2v3M17 2v3M3.5 9h17" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M6 6h12a2.5 2.5 0 0 1 2.5 2.5V19A2.5 2.5 0 0 1 18 21.5H6A2.5 2.5 0 0 1 3.5 19V8.5A2.5 2.5 0 0 1 6 6Z" stroke="white" stroke-opacity=".9" stroke-width="1.6"/>
                </svg>
              </div>
              <div class="field">
                <label for="checkOutDate">Date de d√©part</label>
                <input id="checkOutDate" name="checkOutDate" class="dateInput" placeholder="Choisir une date" autocomplete="off" required />
                <svg class="calIcon" id="calIconOut" viewBox="0 0 24 24" fill="none" aria-label="Ouvrir calendrier d√©part" role="button">
                  <path d="M7 2v3M17 2v3M3.5 9h17" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M6 6h12a2.5 2.5 0 0 1 2.5 2.5V19A2.5 2.5 0 0 1 18 21.5H6A2.5 2.5 0 0 1 3.5 19V8.5A2.5 2.5 0 0 1 6 6Z" stroke="white" stroke-opacity=".9" stroke-width="1.6"/>
                </svg>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="step" data-step="2" style="display:none">
            <div class="grid2">
              <div class="field">
                <label for="adults">Adultes</label>
                <input id="adults" name="adults" type="number" min="1" max="9" value="2" />
              </div>
              <div class="field">
                <label for="children">Enfants</label>
                <input id="children" name="children" type="number" min="0" max="9" value="0" />
              </div>
            </div>

            <div class="grid2">
              <div class="field">
                <label for="roomQuantity">Chambres</label>
                <input id="roomQuantity" name="roomQuantity" type="number" min="1" max="9" value="1" />
              </div>
              <div class="field">
                <label for="budget">Budget total (optionnel)</label>
                <input id="budget" name="budget" type="number" min="0" step="50" placeholder="Ex : 1200" />
              </div>
            </div>

            <div class="field">
              <label>Style</label>
              <div class="pillGroup" id="stylePills">
                <span class="pill" data-value="balanced" data-on="1">√âquilibr√©</span>
                <span class="pill" data-value="budget">Petit budget</span>
                <span class="pill" data-value="comfort">Confort</span>
                <span class="pill" data-value="luxury">Luxe</span>
              </div>
              <input class="sr" id="style" name="style" value="balanced" />
            </div>

            <div class="field">
              <label>Centres d‚Äôint√©r√™t (optionnel)</label>
              <div class="chips" id="chips">
                <span class="chip" data-value="culture">Culture</span>
                <span class="chip" data-value="food">Food</span>
                <span class="chip" data-value="nature">Nature</span>
                <span class="chip" data-value="festivities">Festivit√©s</span>
                <span class="chip" data-value="romance">Romantique</span>
                <span class="chip" data-value="family">Famille</span>
                <span class="chip" data-value="adventure">Aventure</span>
                <span class="chip" data-value="beach">Plage</span>
                <span class="chip" data-value="shopping">Shopping</span>
                <span class="chip" data-value="relax">D√©tente</span>
              </div>
              <input class="sr" id="interests" name="interests" value="" />
            </div>
          </div>

          <!-- STEP 3 -->
          <div class="step" data-step="3" style="display:none">
            <div class="field">
              <label for="notes">Notes (optionnel)</label>
              <textarea id="notes" name="notes" maxlength="300" placeholder="Ex : h√¥tel proche centre, d√©part le matin, pas trop de marche‚Ä¶"></textarea>
              <div class="counterRow">
                <span>Max 300 caract√®res</span>
                <span id="notesCount">0/300</span>
              </div>
            </div>

            <div class="field">
              <label>R√©capitulatif</label>
              <div class="recap" id="recapBox">
                <div class="row"><span>Destination</span><span>‚Äî</span></div>
                <div class="row"><span>Dates</span><span>‚Äî</span></div>
                <div class="row"><span>Voyageurs</span><span>‚Äî</span></div>
                <div class="row"><span>Style</span><span>‚Äî</span></div>
                <div class="row"><span>Budget</span><span>‚Äî</span></div>
              </div>
            </div>

            <!-- R√©sultat affich√© √† la fin -->
            <div class="field" id="resultWrap" style="display:none;">
              <label>Ton r√©sultat</label>
              <div class="cards" id="resultCards"></div>
              <div class="divider"></div>
              <div class="muted">Si tu veux, tu peux ensuite brancher l‚Äôenvoi par email via n8n (optionnel).</div>
            </div>
          </div>

          <!-- Navigation buttons -->
          <div style="display:flex;gap:10px;">
            <button type="button" class="secondaryBtn" id="backBtn" style="flex:1;display:none;">Retour</button>
            <button type="button" class="btn" id="nextBtn" style="flex:2;">Continuer</button>
          </div>

          <p class="fine">Travel Here ‚Äî exp√©rience mobile premium.</p>
        </form>
      </aside>

    </div>
  </div>

  <!-- Custom Date Picker -->
  <div class="dpBackdrop" id="dpBackdrop">
    <div class="dp" role="dialog" aria-modal="true" aria-label="Choisir une date">
      <div class="dpHeader">
        <b id="dpTitle">Mois</b>
        <div class="dpNav">
          <button class="dpBtn" id="dpPrev" type="button">‚Äπ</button>
          <button class="dpBtn" id="dpNext" type="button">‚Ä∫</button>
        </div>
      </div>
      <div class="dpGrid">
        <div class="dpWeek">
          <div>L</div><div>M</div><div>M</div><div>J</div><div>V</div><div>S</div><div>D</div>
        </div>
        <div class="dpDays" id="dpDays"></div>
      </div>
    </div>
  </div>

  <script>
    // ======== Style pills -> hidden input ========
    const stylePills = document.getElementById('stylePills');
    const styleInput = document.getElementById('style');
    stylePills.addEventListener('click', (e) => {
      const pill = e.target.closest('.pill');
      if(!pill) return;
      [...stylePills.querySelectorAll('.pill')].forEach(p => p.dataset.on = "0");
      pill.dataset.on = "1";
      styleInput.value = pill.dataset.value;
      updateRecap();
    });

    // ======== Interests chips -> CSV hidden input ========
    const chips = document.getElementById('chips');
    const interestsInput = document.getElementById('interests');
    chips.addEventListener('click', (e) => {
      const chip = e.target.closest('.chip');
      if(!chip) return;
      chip.dataset.on = chip.dataset.on === "1" ? "0" : "1";
      const on = [...chips.querySelectorAll('.chip[data-on="1"]')].map(el => el.dataset.value);
      interestsInput.value = on.join(',');
    });

    // ======== Notes max + counter ========
    const notesEl = document.getElementById('notes');
    const notesCount = document.getElementById('notesCount');
    function updateNotesCount(){
      const len = (notesEl.value || "").length;
      notesCount.textContent = `${len}/300`;
    }
    notesEl.addEventListener('input', updateNotesCount);
    updateNotesCount();

    // ======== Cities autocomplete (ALL cities via OpenStreetMap Nominatim) ========
    async function fetchCitySuggestions(query){
      const q = query.trim();
      if(q.length < 2) return [];
      const url = "https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=8&accept-language=fr&q=" + encodeURIComponent(q);
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if(!res.ok) throw new Error("nominatim");
      const data = await res.json();

      return data.map(item => {
        const city = item.address?.city || item.address?.town || item.address?.village || item.address?.municipality || item.display_name?.split(",")[0] || "";
        const country = item.address?.country || "";
        return {
          label: city ? `${city} ‚Äî ${country}` : item.display_name,
          value: city ? `${city}` : item.display_name
        };
      }).filter(x => x.value);
    }

    function attachSuggest(inputId, suggestId){
      const input = document.getElementById(inputId);
      const box = document.getElementById(suggestId);
      let lastReq = 0;

      function hide(){ box.style.display = "none"; box.innerHTML = ""; }

      function render(items, rawInput){
        const q = (rawInput || "").trim();
        const fallback = q.length >= 2
          ? `<button type="button" data-value="${q}">
               <div>Utiliser : <strong>${q}</strong> <span class="muted">‚Äî (si non list√©)</span></div>
             </button>`
          : "";

        const htmlItems = items.map(it => `
          <button type="button" data-value="${it.value}">
            <div>${it.label}</div>
          </button>
        `).join("");

        if(!htmlItems && !fallback){ hide(); return; }

        box.innerHTML = htmlItems + (fallback ? `<div style="height:1px;background:rgba(255,255,255,.12)"></div>${fallback}` : "");
        box.style.display = "block";
      }

      input.addEventListener("input", async () => {
        const q = input.value;
        const reqId = ++lastReq;

        if(q.trim().length < 2){
          render([], q);
          return;
        }

        try{
          const items = await fetchCitySuggestions(q);
          if(reqId !== lastReq) return;
          render(items, q);
        }catch(e){
          if(reqId !== lastReq) return;
          render([], q);
        }
      });

      box.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if(!btn) return;
        input.value = btn.dataset.value;
        hide();
        updateRecap();
        input.dispatchEvent(new Event("change"));
      });

      document.addEventListener("click", (e) => {
        if(e.target === input || box.contains(e.target)) return;
        hide();
      });

      input.addEventListener("keydown", (e) => { if(e.key === "Escape") hide(); });
    }

    attachSuggest("origin", "originSuggest");
    attachSuggest("destination", "destSuggest");

    // ======== Date Picker (desktop custom; mobile native) ========
    const dpBackdrop = document.getElementById("dpBackdrop");
    const dpTitle = document.getElementById("dpTitle");
    const dpDays = document.getElementById("dpDays");
    const dpPrev = document.getElementById("dpPrev");
    const dpNext = document.getElementById("dpNext");

    let activeDateInput = null;
    let viewDate = new Date();
    let selectedDateISO = null;

    const MONTHS_FR = ["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];
    function pad(n){ return String(n).padStart(2,"0"); }
    function toISO(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
    function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
    function daysInMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0).getDate(); }

    function openDatePicker(inputEl){
      activeDateInput = inputEl;

      if(inputEl.value && /^\d{4}-\d{2}-\d{2}$/.test(inputEl.value)){
        const [y,m,da] = inputEl.value.split("-").map(Number);
        viewDate = new Date(y, m-1, 1);
        selectedDateISO = inputEl.value;
      } else {
        viewDate = new Date();
        selectedDateISO = null;
      }

      renderCalendar();
      dpBackdrop.style.display = "flex";
      document.body.style.overflow = "hidden";
    }

    function closeDatePicker(){
      dpBackdrop.style.display = "none";
      document.body.style.overflow = "";
      activeDateInput = null;
    }

    function renderCalendar(){
      const m = viewDate.getMonth();
      const y = viewDate.getFullYear();
      dpTitle.textContent = `${MONTHS_FR[m]} ${y}`;

      dpDays.innerHTML = "";
      const first = startOfMonth(viewDate);
      const firstDow = (first.getDay() + 6) % 7; // Monday=0
      const total = daysInMonth(viewDate);

      for(let i=0;i<firstDow;i++){
        const blank = document.createElement("div");
        blank.style.height = "40px";
        dpDays.appendChild(blank);
      }

      const todayISO = toISO(new Date());

      for(let day=1; day<=total; day++){
        const d = new Date(y, m, day);
        const iso = toISO(d);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "day";
        btn.textContent = String(day);

        if(iso === todayISO) btn.classList.add("isToday");
        if(selectedDateISO && iso === selectedDateISO) btn.classList.add("isSelected");

        btn.addEventListener("click", () => {
          selectedDateISO = iso;
          if(activeDateInput){
            activeDateInput.value = iso;
            activeDateInput.dispatchEvent(new Event("change"));
            updateRecap();
          }
          closeDatePicker();
        });

        dpDays.appendChild(btn);
      }
    }

    dpPrev.addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1);
      renderCalendar();
    });
    dpNext.addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1);
      renderCalendar();
    });
    dpBackdrop.addEventListener("click", (e) => { if(e.target === dpBackdrop) closeDatePicker(); });

    function isMobile(){
      return window.matchMedia("(max-width: 900px)").matches || /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    const checkIn = document.getElementById("checkInDate");
    const checkOut = document.getElementById("checkOutDate");
    const calIconIn = document.getElementById("calIconIn");
    const calIconOut = document.getElementById("calIconOut");

    function enableDateUX(){
      if(isMobile()){
        checkIn.type = "date";
        checkOut.type = "date";
        checkIn.placeholder = "";
        checkOut.placeholder = "";

        // ‚úÖ ic√¥ne calendrier ouvre le natif (focus/click)
        calIconIn.addEventListener("click", () => { checkIn.showPicker?.(); checkIn.focus(); checkIn.click(); });
        calIconOut.addEventListener("click", () => { checkOut.showPicker?.(); checkOut.focus(); checkOut.click(); });
        return;
      }

      checkIn.type = "text";
      checkOut.type = "text";
      checkIn.addEventListener("click", () => openDatePicker(checkIn));
      checkOut.addEventListener("click", () => openDatePicker(checkOut));
      checkIn.addEventListener("keydown", (e) => e.preventDefault());
      checkOut.addEventListener("keydown", (e) => e.preventDefault());

      // ‚úÖ ic√¥ne calendrier ouvre aussi
      calIconIn.addEventListener("click", () => openDatePicker(checkIn));
      calIconOut.addEventListener("click", () => openDatePicker(checkOut));
    }
    enableDateUX();

    // ======== 3-step navigation + progress ========
    let currentStep = 1;
    const steps = [...document.querySelectorAll('.step[data-step]')];
    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');
    const stepLabel = document.getElementById('stepLabel');
    const stepHint = document.getElementById('stepHint');
    const progressBar = document.getElementById('progressBar');

    const hints = { 1: "Voyage", 2: "Pr√©f√©rences", 3: "Finalisation" };

    function showStep(n){
      currentStep = n;
      steps.forEach(s => s.style.display = (Number(s.dataset.step) === n) ? "block" : "none");
      backBtn.style.display = (n === 1) ? "none" : "inline-flex";
      nextBtn.textContent = (n === 3) ? "Afficher mon r√©sultat" : "Continuer";
      stepLabel.textContent = `√âtape ${n}/3`;
      stepHint.textContent = hints[n] || "";
      progressBar.style.width = (n === 1 ? "33%" : n === 2 ? "66%" : "100%");
      window.scrollTo({top: 0, behavior: "smooth"});
      updateRecap();
    }

    function isValidDates(inDate, outDate){
      try{
        const a = new Date(inDate);
        const b = new Date(outDate);
        return b > a;
      }catch(e){ return false; }
    }

    function requiredOkForStep1(){
      const dest = document.getElementById('destination')?.value?.trim();
      const inD = document.getElementById('checkInDate')?.value?.trim();
      const outD = document.getElementById('checkOutDate')?.value?.trim();
      if(!dest || !inD || !outD) return false;
      if(!isValidDates(inD, outD)) return false;
      return true;
    }

    backBtn.addEventListener('click', () => {
      if(currentStep > 1) showStep(currentStep - 1);
    });

    nextBtn.addEventListener('click', async () => {
      if(currentStep === 1){
        if(!requiredOkForStep1()){
          alert("Remplis destination + dates (et v√©rifie que la date de d√©part est apr√®s l‚Äôarriv√©e).");
          return;
        }
        showStep(2);
        return;
      }
      if(currentStep === 2){
        showStep(3);
        return;
      }
      if(currentStep === 3){
        // ‚úÖ Affiche un r√©sultat "tr√®s beau" dans la page (d√©mo UI).
        // Ensuite tu pourras le brancher √† n8n (webhook) pour un vrai r√©sultat.
        await showBeautifulResultDemo();
      }
    });

    // ======== Recap ========
    function updateRecap(){
      const dest = document.getElementById('destination')?.value?.trim() || "‚Äî";
      const inD = document.getElementById('checkInDate')?.value?.trim() || "‚Äî";
      const outD = document.getElementById('checkOutDate')?.value?.trim() || "‚Äî";
      const adults = document.getElementById('adults')?.value || "2";
      const children = document.getElementById('children')?.value || "0";
      const style = document.getElementById('style')?.value || "balanced";
      const budget = document.getElementById('budget')?.value?.trim() ? `${document.getElementById('budget').value} ‚Ç¨` : "‚Äî";

      const styleLabel = ({
        balanced: "√âquilibr√©",
        budget: "Petit budget",
        comfort: "Confort",
        luxury: "Luxe"
      })[style] || style;

      const box = document.getElementById('recapBox');
      if(!box) return;

      box.innerHTML = `
        <div class="row"><span>Destination</span><span>${escapeHtml(dest)}</span></div>
        <div class="row"><span>Dates</span><span>${escapeHtml(inD)} ‚Üí ${escapeHtml(outD)}</span></div>
        <div class="row"><span>Voyageurs</span><span>${escapeHtml(adults)} adultes, ${escapeHtml(children)} enfants</span></div>
        <div class="row"><span>Style</span><span>${escapeHtml(styleLabel)}</span></div>
        <div class="row"><span>Budget</span><span>${escapeHtml(budget)}</span></div>
      `;
    }

    function escapeHtml(str){
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ======== Beautiful result (DEMO) ========
    async function showBeautifulResultDemo(){
      const wrap = document.getElementById("resultWrap");
      const cards = document.getElementById("resultCards");
      wrap.style.display = "block";

      // loading UI
      cards.innerHTML = `
        <div class="card">
          <h3>Pr√©paration de ton Top 3 <span class="tag">en cours</span></h3>
          <div class="loadingLine" style="margin-top:10px;"></div>
          <div class="loadingLine" style="margin-top:10px;width:78%;"></div>
          <div class="loadingLine" style="margin-top:10px;width:62%;"></div>
          <div class="muted" style="margin-top:10px;">On s√©lectionne les meilleures options pour ton voyage‚Ä¶</div>
        </div>
      `;
      nextBtn.disabled = true;
      nextBtn.textContent = "G√©n√©ration‚Ä¶";

      // simulate loading
      await new Promise(r => setTimeout(r, 900));

      const dest = document.getElementById('destination')?.value?.trim() || "Ta destination";
      const inD = document.getElementById('checkInDate')?.value?.trim() || "‚Äî";
      const outD = document.getElementById('checkOutDate')?.value?.trim() || "‚Äî";

      // Demo results (√† remplacer par r√©ponse n8n)
      cards.innerHTML = `
        <div class="card">
          <h3>Top 3 Vols <span class="tag">optimis√©</span></h3>
          <div class="muted">1) Vol direct ‚Ä¢ matin ‚Ä¢ prix indicatif : <b>‚Äî</b></div>
          <div class="muted">2) 1 escale courte ‚Ä¢ meilleur rapport qualit√©/prix : <b>‚Äî</b></div>
          <div class="muted">3) Option flexible ‚Ä¢ retour confortable : <b>‚Äî</b></div>
        </div>

        <div class="card">
          <h3>Top 3 H√¥tels <span class="tag">bien plac√©s</span></h3>
          <div class="muted">1) Centre-ville ‚Ä¢ note √©lev√©e ‚Ä¢ prix : <b>prix indispo</b></div>
          <div class="muted">2) Quartier premium ‚Ä¢ bon confort ‚Ä¢ prix : <b>prix indispo</b></div>
          <div class="muted">3) Bon budget ‚Ä¢ propre ‚Ä¢ prix : <b>prix indispo</b></div>
        </div>

        <div class="card">
          <h3>Top 3 Activit√©s <span class="tag">√† faire</span></h3>
          <div class="muted">1) Incontournable local ‚Ä¢ dur√©e : <b>‚Äî</b></div>
          <div class="muted">2) Exp√©rience premium ‚Ä¢ r√©servation conseill√©e</div>
          <div class="muted">3) Spot photo + ambiance ‚Ä¢ parfait pour ${escapeHtml(dest)}</div>
        </div>

        <div class="card">
          <h3>R√©sum√© <span class="tag">${escapeHtml(inD)} ‚Üí ${escapeHtml(outD)}</span></h3>
          <div class="muted">Ton Top 3 s‚Äôaffiche ici en d√©mo. La prochaine √©tape est de brancher ce bloc aux r√©sultats r√©els (n8n) pour afficher les vrais prix et liens.</div>
        </div>
      `;

      nextBtn.disabled = false;
      nextBtn.textContent = "Relancer / Modifier";
    }

    // live recap updates
    ["destination","checkInDate","checkOutDate","adults","children","budget","style"].forEach(id => {
      const el = document.getElementById(id);
      if(el) el.addEventListener("change", updateRecap);
      if(el) el.addEventListener("input", updateRecap);
    });

    showStep(1);
    updateRecap();
  </script>
</body>
</html>
